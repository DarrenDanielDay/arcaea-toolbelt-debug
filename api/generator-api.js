var e,t,r,o,n,a,s,i,c,l,p,u,d,f;let y=()=>{let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),get done(){return e},get abort(){return t}}},b=e=>{let t=r=>new Proxy(function(){},{get(e,o){if("symbol"==typeof o)throw Error("Cannot get symbol property.");return t([...r,o])},apply:(t,o,n)=>e(r,n)});return t([])},h=e=>{if("object"!=typeof e||null==e)return e;if(e instanceof URL)return{_url:e.href};if(Array.isArray(e))return e.map(e=>h(e));let t=Object.getPrototypeOf(e);if(t===Object.prototype||null==t){let r=Object.create(t);for(let[t,o]of Object.entries(e))r[t]=h(o);return r}return e},g=e=>{if("object"!=typeof e||null==e)return e;if("string"==typeof e._url)return new URL(e._url);if(Array.isArray(e))return e.map(e=>g(e));let t=Object.getPrototypeOf(e);if(t===Object.prototype||null==t){let r=Object.create(t);for(let[t,o]of Object.entries(e))r[t]=g(o);return r}return e},w=crypto.randomUUID?.bind(crypto)??(()=>{let e=Date.now();return`${e.toString(16)}-${Math.floor(4294967295*Math.random()).toString(16)}`}),$=(e,t)=>({__arcaea_toolbelt_msg:!0,id:e,...t});(i=e||(e={})).Ping="ping",i.Request="request",i.Response="response",i.Error="error";let m=e=>!!(e&&"invoke"===e.type),R=e=>!!(e&&e.__arcaea_toolbelt_msg);class C{#e=new Map;create(e){let t=e??w(),r=y();return this.#e.set(t,r),{id:t,task:r}}done(e,t){this.#t(e)?.done(t)}abort(e,t){this.#t(e)?.abort(t)}#t(e){let t=this.#e.get(e);return t||console.error(`Task id ${e} does not exist.`),t}}class P{connect;constructor(e){this.connect=e}start(e){return new E(this.connect(),e)}}class E{connection;#r;constructor(e,t){this.connection=e;let{input:r}=this.connection;this.#r=e=>{t(g(e.data))},r.addEventListener("message",this.#r)}post(e){let{output:t}=this.connection;t.postMessage(h(e),"*")}stop(){let{input:e}=this.connection;e.removeEventListener("message",this.#r)}}class k{options;constructor(e){this.options=e}start(){let t=new C,r="ping",{task:{promise:o}}=t.create(r),n=$(r,{type:e.Ping}),a=()=>{l.post(n)},s=!1,i=()=>{s||(s=!0,a())},c=setInterval(a,100),l=this.options.hub.start(async o=>{if(R(o))switch(o.type){case e.Ping:i(),clearInterval(c),t.done(r,o);break;case e.Request:await this.onRequest(o,l);break;case e.Response:await this.onResponse(o,t);break;case e.Error:default:await this.onError(o,t)}});return{pool:t,api:b(async(r,n)=>{await o;let{id:a,task:s}=t.create(),i=$(a,{type:e.Request,body:{type:"invoke",args:n,path:r}});return l.post(i),s.promise}),stop(){clearInterval(c),l.stop(),t.abort(r)}}}async onRequest(t,r){let{body:o,id:n}=t;if(m(o))try{let t,a=this.options.impl,{path:s,args:i}=o;for(let e of s)t=a,a=Reflect.get(a,e);let c=await Reflect.apply(a,t,i),l=$(n,{type:e.Response,body:c});r.post(l)}catch(t){r.post($(n,{type:e.Error,error:t}))}}async onResponse(e,t){t.done(e.id,e.body)}async onError(e,t){t.abort(e.id,e.error)}}(c=t||(t={})).Initial="",c.Awaken="u",c.Lost="l",(l=r||(r={}))[l.Icon=0]="Icon",l[l.Full=1]="Full",(p=o||(o={}))[p.Light=0]="Light",p[p.Conflict=1]="Conflict",p[p.Colorless=2]="Colorless",(u=n||(n={})).Past="pst",u.Present="prs",u.Future="ftr",u.Beyond="byd",n.Past,n.Present,n.Future,n.Beyond,n.Past,n.Present,n.Future,n.Beyond,(d=a||(a={})).EXPlus="EX+",d.EX="EX",d.AA="AA",d.A="A",d.B="B",d.C="C",d.D="D",(f=s||(s={})).Maximum="Max",f.PureMemory="PM",f.FullRecall="FR",f.EasyClear="EC",f.NormalClear="NC",f.HardClear="HC",f.TrackLost="TL";let x=e=>new k({hub:new P(()=>{let e=window.parent;if(e===window)throw Error("No parent window detected.");return{input:window,output:e}}),impl:e});export{x as createRpc,r as CharacterImageKind,t as CharacterStatus,a as Grade,o as Side,s as ClearRank,n as Difficulty};
//# sourceMappingURL=generator-api.js.map
